<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="main.css">
  <title>Spell Macro Generator</title>
</head>
<body>
  <section class="hero is-danger">
    <div class="hero-body">
      <p class="title">
        Spell Macro Generator
      </p>
      <p class="subtitle">
        Try out the spell damage macro generator!
      </p>
    </div>
  </section>
  
  <div class="columns">
    <div class="column m-2">
      <div class="box">
        <div class="field">
          <label class="label">Base Spell Level:</label>
          <div class="control">
            <input class="input" type="number" id="base-spell-level" min="1" max="9" value="1">
          </div>
        </div>
    
        <div class="field">
          <label class="label">Base Damage:</label>
          <div class="control">
            <input class="input" type="text" id="base-damage" placeholder="ex. 3d6 for fireball">
          </div>
        </div>
        
        <div class="field">
          <label class="label">Damage Dice Per Level:</label>
          <div class="control">
            <input class="input" type="text" id="damage-per-level" placeholder="ex. d6 for fireball" >
          </div>
        </div>
    
        <div class="field">
          <label class="label">Max Spell Slot for scaling:</label>
          <div class="control">
            <input class="input" type="number" id="max-spell-level" value="9" min="1" max="9">
          </div>
        </div>
    
        <div class="block">
          <button class="button is-link" onclick="generateMacro()">Generate</button>
        </div>
      </div>
    </div>

    <div class="column m-2">
      <div class="box">
        <div class="content">
          <p class="has-text-centered">Paste this macro into a spell's damage box or wrap it in [[ ]] to use on its own!</p>
          <textarea class="textarea has-fixed-size is-info" id="macro" readonly>Macro will appear here...</textarea>
        </div>
        <button class="button card-footer-item is-link is-fullwidth" onclick="copyMacroToClipboard()">Copy</button>
      </div>
    </div>
  </div>
  
  <script>
      async function generateMacro() {
        let baseSpellLevel = document.getElementById("base-spell-level").value;
        let damagePerLevel = document.getElementById("damage-per-level").value;
        let baseDamage = document.getElementById("base-damage").value;
        let maxSpellLevel = document.getElementById("max-spell-level").value;

        var url = new URL('/spell_macro', document.location)

        var params = {
            base_spell_slot:baseSpellLevel, 
            damage_per_level:damagePerLevel,
            static_damage:baseDamage,
            max_slot:maxSpellLevel
          }

        url.search = new URLSearchParams(params).toString();

        let response = await fetch(url);

        if (response.ok) {
          let macroResponse = await response.json()
          document.getElementById("macro").value = macroResponse.macro;
        } else {
          alert("HTTP-Error: " + response.status);
        }
      }

      function copyMacroToClipboard() {
        var copyText = document.getElementById("macro");

        /* Select the text field */
        copyText.select();
        copyText.setSelectionRange(0, 99999); /* For mobile devices */

        /* Copy to clipboard*/
        navigator.clipboard.writeText(copyText.value);
      }
  </script>
</body>
</html>